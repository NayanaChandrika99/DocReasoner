# TreeStore - Hierarchical Document Database in Go

## Overview

TreeStore is a specialized database built from scratch in Go, optimized for storing and querying hierarchical document structures generated by PageIndex. Unlike traditional vector databases, TreeStore focuses on structural relationships and reasoning-based retrieval.

## Key Features

### Core Database
- ğŸ—ï¸ **Custom B+Tree Storage Engine** - Built from scratch with WAL-based durability
- ğŸŒ² **Hierarchical Indexing** - Optimized for parent/child relationships and tree traversal
- ğŸ” **Keyword Search** - Full-text search without vector embeddings
- âš¡ **High Performance** - Sub-10ms query latency for tree operations
- ğŸ”Œ **gRPC API** - Language-agnostic interface for Python integration
- ğŸ“Š **Production Ready** - ACID transactions, crash recovery, observability

### Extended Features (NEW)
- ğŸ“… **Temporal Queries** - Get policy version "as of" specific date (supports `temporal_lookup` tool)
- ğŸ”— **Cross-References** - Navigate policy relationships (supports `policy_xref` tool)
- ğŸ›¤ï¸ **Trajectory Storage** - Store and analyze search paths from `pi_search` tool
- ğŸ“ **Prompt Versioning** - Track which prompts produced which decisions
- ğŸ§ª **Tool Result Storage** - Store outputs from all ReAct controller tools
- âš–ï¸ **Contradiction Tracking** - Store detected contradictions for analysis

## Why TreeStore?

PageIndex generates hierarchical document trees through reasoning, NOT vector similarity. TreeStore is purpose-built for this paradigm:

- âœ… **No Vectors** - Aligns with PageIndex's "no vector DB" philosophy
- âœ… **Structural Navigation** - Fast parent/child, ancestor, and subtree queries
- âœ… **Reasoning-Based** - Supports LLM-driven tree search patterns
- âœ… **Transparent** - Clear query paths, not black-box similarity scores

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PageIndex (Python)                                  â”‚
â”‚  Generates hierarchical tree from PDF               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ JSON tree structure
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TreeStore (Go)                                      â”‚
â”‚  â”œâ”€ B+Tree Storage Engine                           â”‚
â”‚  â”œâ”€ Hierarchical Index                              â”‚
â”‚  â”œâ”€ Full-Text Search                                â”‚
â”‚  â”œâ”€ Transaction Manager                             â”‚
â”‚  â””â”€ gRPC API Server                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ gRPC
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Python Reasoning Service                           â”‚
â”‚  Uses TreeStore for document storage & retrieval    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Project Status

ğŸš§ **In Development** - Following phased implementation plan

- [ ] Phase 1: Core Database (Weeks 1-3) - B+Tree, WAL, Transactions
- [ ] Phase 2: Advanced Features (Weeks 4-6) - Secondary indexes, Document layer
- [ ] Phase 3: Extended Stores (Weeks 7-9) - VersionStore, MetadataStore, PromptStore
- [ ] Phase 4: API & Integration (Weeks 10-11) - gRPC API, Python client
- [ ] Phase 5: Production Polish (Weeks 12-13) - Observability, deployment

## Documentation

- [Implementation Plan](./IMPLEMENTATION_PLAN.md) - Detailed roadmap and milestones
- [Architecture](./ARCHITECTURE.md) - System design and technical decisions
- [Project Structure](./PROJECT_STRUCTURE.md) - File organization
- [API Documentation](./API.md) - gRPC API reference (coming soon)

## Quick Start

```bash
# Initialize project
cd tree_db
go mod init github.com/yourusername/treestore
go mod tidy

# Build
make build

# Run tests
make test

# Start server
./bin/treestore --port 50051
```

### Usage Example

```python
from treestore import TreeStoreClient

# Connect to TreeStore
client = TreeStoreClient('localhost:50051')

# Store PageIndex output
client.store_document(
    policy_id="LCD-L34220",
    version_id="2024-01",
    tree=pageindex_tree
)

# Query nodes
node = client.get_node(
    policy_id="LCD-L34220",
    node_id="0042"
)

# Temporal query (supports temporal_lookup tool)
version = client.get_version_as_of(
    policy_id="LCD-L34220",
    as_of_date="2024-01-15"
)

# Store tool result
client.store_tool_result(
    case_id="case_123",
    tool_name="pi_search",
    result=search_result
)

# Get cross-references (supports policy_xref tool)
refs = client.get_cross_references(
    policy_id="LCD-L34220",
    node_id="0042"
)
```

## Learning Resources

This project is built by following:
- [Build Your Own Database From Scratch in Go](https://build-your-own.org/database/)
- Database Internals by Alex Petrov
- Reference implementations: go-memdb, BadgerDB, CloverDB

## Portfolio Highlights

**What makes this project impressive:**

1. **Built from Scratch** - No framework dependencies for core database logic
2. **Production Use** - Integrated into real reasoning-service system
3. **Domain-Specific Optimization** - Tailored for hierarchical documents
4. **Performance Benchmarks** - Measured improvements over PostgreSQL
5. **Full-Stack Integration** - Go backend + Python client + gRPC

## License

MIT License

## Contact

Nainy - Portfolio Project 2024

